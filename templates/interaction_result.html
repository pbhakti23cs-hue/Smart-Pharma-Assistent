{% extends "base.html" %}

{% block title %}Interaction Results - Smart Pharma Assistant{% endblock %}

{% block extra_css %}
<style>
    .results-container {
        padding: 20px 0;
        min-height: 70vh;
    }
    
    .page-header {
        background: linear-gradient(135deg, var(--severity-color), var(--severity-color-dark));
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .page-header::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, rgba(255,255,255,0.15) 1px, transparent 1px);
        background-size: 20px 20px;
        opacity: 0.3;
    }
    
    .page-title {
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .page-subtitle {
        opacity: 0.9;
        font-weight: 300;
        font-size: 1.1rem;
        position: relative;
        z-index: 1;
        max-width: 800px;
    }
    
    .results-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 40px;
    }
    
    @media (max-width: 1024px) {
        .results-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .drug-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border: 2px solid rgba(0, 0, 0, 0.05);
        transition: all 0.3s;
    }
    
    .drug-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
    }
    
    .drug-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid #F0F4F8;
    }
    
    .drug-icon {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #1565C0, #0D47A1);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        flex-shrink: 0;
    }
    
    .drug-icon.secondary {
        background: linear-gradient(135deg, #00897B, #00695C);
    }
    
    .drug-name {
        font-size: 1.8rem;
        font-weight: 800;
        color: #2C3E50;
        margin-bottom: 5px;
    }
    
    .drug-type {
        font-size: 1rem;
        color: #78909C;
        font-weight: 500;
    }
    
    .drug-details {
        display: grid;
        gap: 20px;
    }
    
    .detail-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
    }
    
    .detail-icon {
        color: #1565C0;
        font-size: 1.2rem;
        margin-top: 2px;
        flex-shrink: 0;
    }
    
    .detail-content {
        flex: 1;
    }
    
    .detail-label {
        font-size: 0.9rem;
        color: #78909C;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
        font-weight: 600;
    }
    
    .detail-value {
        font-size: 1.1rem;
        color: #2C3E50;
        line-height: 1.5;
        font-weight: 500;
    }
    
    .detail-value.multiline {
        white-space: pre-line;
        line-height: 1.6;
    }
    
    .interaction-result {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border: 2px solid var(--severity-border);
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }
    
    .interaction-result::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, var(--severity-bg), transparent);
        opacity: 0.05;
        z-index: 0;
    }
    
    .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        position: relative;
        z-index: 1;
    }
    
    .result-title {
        font-size: 1.6rem;
        font-weight: 800;
        color: var(--severity-color);
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .severity-badge {
        padding: 8px 20px;
        border-radius: 20px;
        font-weight: 800;
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: var(--severity-bg);
        color: var(--severity-color);
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 0 rgba(0,0,0,0.1);
    }
    
    .result-content {
        position: relative;
        z-index: 1;
    }
    
    .interaction-description {
        background: #F8F9FA;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 25px;
        border-left: 5px solid var(--severity-color);
    }
    
    .description-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--severity-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .description-text {
        font-size: 1.1rem;
        color: #2C3E50;
        line-height: 1.6;
        margin: 0;
    }
    
    .recommendation-box {
        background: linear-gradient(135deg, var(--severity-bg), rgba(255,255,255,0.9));
        border-radius: 10px;
        padding: 25px;
        border: 2px solid var(--severity-border);
    }
    
    .recommendation-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--severity-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .recommendation-text {
        font-size: 1.1rem;
        color: #2C3E50;
        line-height: 1.6;
        margin: 0;
    }
    
    .actions-section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
        border: 2px solid #F0F4F8;
    }
    
    .section-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: #1565C0;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 12px;
        padding-left: 15px;
        border-left: 5px solid #1565C0;
    }
    
    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }
    
    .action-card {
        background: #F8F9FA;
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        transition: all 0.3s;
        text-decoration: none;
        color: inherit;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        border: 2px solid transparent;
    }
    
    .action-card:hover {
        background: white;
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border-color: var(--severity-border);
        text-decoration: none;
    }
    
    .action-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        color: white;
        background: linear-gradient(135deg, var(--action-color), var(--action-color-dark));
    }
    
    .action-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #2C3E50;
    }
    
    .action-desc {
        font-size: 0.9rem;
        color: #78909C;
        line-height: 1.4;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        margin: 30px 0;
    }
    
    .empty-icon {
        font-size: 4rem;
        color: #BBDEFB;
        margin-bottom: 20px;
        animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }
    
    .empty-title {
        font-size: 1.8rem;
        color: #2C3E50;
        margin-bottom: 15px;
        font-weight: 700;
    }
    
    .empty-description {
        color: #78909C;
        max-width: 500px;
        margin: 0 auto 30px;
        line-height: 1.6;
        font-size: 1.1rem;
    }
    
    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 15px 30px;
        background: linear-gradient(135deg, #1565C0, #0D47A1);
        color: white;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
        box-shadow: 0 4px 0 #0D47A1;
    }
    
    .back-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 0 #0D47A1, 0 10px 20px rgba(21, 101, 192, 0.2);
        color: white;
        text-decoration: none;
    }
    
    .risk-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }
    
    .risk-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    .risk-high {
        background: #F44336;
        box-shadow: 0 0 10px #F44336;
    }
    
    .risk-medium {
        background: #FF9800;
        box-shadow: 0 0 10px #FF9800;
    }
    
    .risk-low {
        background: #4CAF50;
        box-shadow: 0 0 10px #4CAF50;
    }
    
    .risk-none {
        background: #9E9E9E;
        box-shadow: 0 0 10px #9E9E9E;
    }
    
    .patient-notes {
        background: #E8F5E9;
        border-radius: 10px;
        padding: 25px;
        margin-top: 30px;
        border: 2px solid #C8E6C9;
    }
    
    .notes-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: #388E3C;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .notes-content {
        font-size: 1rem;
        color: #2E7D32;
        line-height: 1.6;
        margin: 0;
    }
    
    /* Severity-specific styles */
    .severity-high {
        --severity-color: #D32F2F;
        --severity-color-dark: #B71C1C;
        --severity-bg: #FFEBEE;
        --severity-border: #FFCDD2;
        --action-color: #D32F2F;
        --action-color-dark: #B71C1C;
    }
    
    .severity-medium {
        --severity-color: #FF8F00;
        --severity-color-dark: #EF6C00;
        --severity-bg: #FFF3CD;
        --severity-border: #FFECB3;
        --action-color: #FF8F00;
        --action-color-dark: #EF6C00;
    }
    
    .severity-low {
        --severity-color: #388E3C;
        --severity-color-dark: #2E7D32;
        --severity-bg: #E8F5E9;
        --severity-border: #C8E6C9;
        --action-color: #388E3C;
        --action-color-dark: #2E7D32;
    }
    
    .severity-none {
        --severity-color: #546E7A;
        --severity-color-dark: #455A64;
        --severity-bg: #ECEFF1;
        --severity-border: #CFD8DC;
        --action-color: #546E7A;
        --action-color-dark: #455A64;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .page-header {
            padding: 25px 20px;
        }
        
        .page-title {
            font-size: 1.8rem;
        }
        
        .drug-header {
            flex-direction: column;
            text-align: center;
            gap: 15px;
        }
        
        .actions-grid {
            grid-template-columns: 1fr;
        }
        
        .result-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }
        
        .severity-badge {
            align-self: flex-start;
        }
    }
    
    @media (max-width: 480px) {
        .drug-card,
        .interaction-result,
        .actions-section {
            padding: 25px 20px;
        }
        
        .drug-name {
            font-size: 1.5rem;
        }
        
        .result-title {
            font-size: 1.3rem;
        }
        
        .section-title {
            font-size: 1.2rem;
        }
    }
    
    /* Print styles */
    @media print {
        .back-link,
        .action-card {
            display: none !important;
        }
        
        .page-header {
            background: white !important;
            color: black !important;
            box-shadow: none !important;
            border: 2px solid black !important;
        }
        
        .interaction-result {
            box-shadow: none !important;
            border: 2px solid black !important;
            break-inside: avoid;
        }
    }
    
    /* Animation for results */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .drug-card,
    .interaction-result,
    .actions-section {
        animation: fadeInUp 0.5s ease-out;
        animation-fill-mode: both;
    }
    
    .drug-card { animation-delay: 0.1s; }
    .interaction-result { animation-delay: 0.2s; }
    .actions-section { animation-delay: 0.4s; }
    
    /* Interaction visualization */
    .interaction-visual {
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: #F8F9FA;
        border-radius: 10px;
        border: 2px dashed #E0E0E0;
    }
    
    .visual-drugs {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .visual-drug {
        background: white;
        padding: 15px 25px;
        border-radius: 10px;
        font-weight: 700;
        font-size: 1.2rem;
        color: #1565C0;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        min-width: 150px;
        text-align: center;
    }
    
    .visual-drug.secondary {
        color: #00897B;
    }
    
    .visual-interaction {
        font-size: 2rem;
        color: var(--severity-color);
        animation: pulse 2s infinite;
    }
    
    /* Pharmacist notes */
    .pharmacist-notes {
        background: #E3F2FD;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        border: 2px solid #BBDEFB;
    }
    
    .notes-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .notes-label {
        font-weight: 700;
        color: #1565C0;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .notes-date {
        font-size: 0.9rem;
        color: #78909C;
    }
    
    .notes-text {
        color: #2C3E50;
        line-height: 1.6;
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}
{% set severity = interaction.severity if interaction else 'None' %}
{% set severity_class = 'severity-' + severity.lower() if severity else 'severity-none' %}

<div class="results-container {{ severity_class }}">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-exclamation-triangle"></i> Interaction Results
        </h1>
        
    </div>
    
    <!-- Drug Information Grid -->
    <div class="results-grid">
        <!-- Drug 1 Card -->
        <div class="drug-card">
            <div class="drug-header">
                <div class="drug-icon">
                    <i class="fas fa-capsules"></i>
                </div>
                <div>
                    <h2 class="drug-name">{{ drug1 }}</h2>
                    <p class="drug-type">{{ get_drug_type(drug1) }}</p>
                </div>
            </div>
            
            <div class="drug-details">
                <div class="detail-item">
                    <span class="detail-icon">
                        <i class="fas fa-flask"></i>
                    </span>
                    <div class="detail-content">
                        <div class="detail-label">Drug Class</div>
                        <div class="detail-value">{{ get_drug_class(drug1) }}</div>
                    </div>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">
                        <i class="fas fa-stethoscope"></i>
                    </span>
                    <div class="detail-content">
                        <div class="detail-label">Primary Uses</div>
                        <div class="detail-value multiline">{{ get_drug_uses(drug1) }}</div>
                    </div>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </span>
                    <div class="detail-content">
                        <div class="detail-label">Common Side Effects</div>
                        <div class="detail-value multiline">{{ get_drug_side_effects(drug1) }}</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Drug 2 Card -->
        <div class="drug-card">
            <div class="drug-header">
                <div class="drug-icon secondary">
                    <i class="fas fa-pills"></i>
                </div>
                <div>
                    <h2 class="drug-name">{{ drug2 }}</h2>
                    <p class="drug-type">{{ get_drug_type(drug2) }}</p>
                </div>
            </div>
            
            <div class="drug-details">
                <div class="detail-item">
                    <span class="detail-icon">
                        <i class="fas fa-flask"></i>
                    </span>
                    <div class="detail-content">
                        <div class="detail-label">Drug Class</div>
                        <div class="detail-value">{{ get_drug_class(drug2) }}</div>
                    </div>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">
                        <i class="fas fa-stethoscope"></i>
                    </span>
                    <div class="detail-content">
                        <div class="detail-label">Primary Uses</div>
                        <div class="detail-value multiline">{{ get_drug_uses(drug2) }}</div>
                    </div>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </span>
                    <div class="detail-content">
                        <div class="detail-label">Common Side Effects</div>
                        <div class="detail-value multiline">{{ get_drug_side_effects(drug2) }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Interaction Visualization -->
    <div class="interaction-visual">
        <div class="visual-drugs">
            <div class="visual-drug">{{ drug1 }}</div>
            <div class="visual-interaction">
                <i class="fas fa-exchange-alt"></i>
            </div>
            <div class="visual-drug secondary">{{ drug2 }}</div>
        </div>
        <div class="risk-indicator" style="justify-content: center;">
            <span class="risk-dot {{ 'risk-' + severity.lower() if severity else 'risk-none' }}"></span>
            <span style="font-weight: 700; color: var(--severity-color); font-size: 1.2rem;">
                {{ severity.upper() if severity else 'NO' }} INTERACTION RISK
            </span>
        </div>
    </div>
    
    <!-- Interaction Result -->
    <div class="interaction-result">
        <div class="result-header">
            <h2 class="result-title">
                <i class="fas fa-clipboard-check"></i> Interaction Analysis
            </h2>
            <div class="severity-badge">
                <i class="fas fa-exclamation-triangle"></i>
                {{ severity.upper() if severity else 'NONE' }} SEVERITY
            </div>
        </div>
        
        <div class="result-content">
            {% if interaction %}
            <div class="interaction-description">
                <h3 class="description-title">
                    <i class="fas fa-info-circle"></i> Interaction Description
                </h3>
                <p class="description-text">
                    {{ interaction.description }}
                </p>
            </div>
            
            <div class="recommendation-box">
                <h3 class="recommendation-title">
                    <i class="fas fa-user-md"></i> Professional Recommendation
                </h3>
                <p class="recommendation-text">
                    {{ interaction.recommendation }}
                </p>
                
                {% if severity == 'High' %}
                <div class="risk-indicator" style="margin-top: 20px;">
                    <span class="risk-dot risk-high"></span>
                    <span style="color: #D32F2F; font-weight: 700;">
                        ⚠️ HIGH RISK: AVOID COMBINATION
                    </span>
                </div>
                {% elif severity == 'Medium' %}
                <div class="risk-indicator" style="margin-top: 20px;">
                    <span class="risk-dot risk-medium"></span>
                    <span style="color: #FF8F00; font-weight: 700;">
                        ⚠️ MEDIUM RISK: USE WITH CAUTION
                    </span>
                </div>
                {% elif severity == 'Low' %}
                <div class="risk-indicator" style="margin-top: 20px;">
                    <span class="risk-dot risk-low"></span>
                    <span style="color: #388E3C; font-weight: 700;">
                        ℹ️ LOW RISK: MONITOR PATIENT
                    </span>
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="interaction-description">
                <h3 class="description-title">
                    <i class="fas fa-check-circle" style="color: #4CAF50;"></i> No Known Interaction
                </h3>
                <p class="description-text">
                    No significant drug-drug interaction found between <strong>{{ drug1 }}</strong> and <strong>{{ drug2 }}</strong> 
                    in our database. However, always consider individual patient factors and monitor for adverse effects.
                </p>
            </div>
            
            <div class="recommendation-box">
                <h3 class="recommendation-title">
                    <i class="fas fa-user-md" style="color: #4CAF50;"></i> General Recommendation
                </h3>
                <p class="recommendation-text">
                    While no specific interaction is documented, always:
                    <ul style="margin: 15px 0 15px 20px; color: #2C3E50;">
                        <li>Monitor patient for any adverse effects</li>
                        <li>Consider individual patient factors (age, liver/kidney function)</li>
                        <li>Review complete medication list</li>
                        <li>Consult prescribing physician if uncertain</li>
                    </ul>
                </p>
            </div>
            {% endif %}
            
            <!-- Pharmacist Notes -->
            <div class="pharmacist-notes">
                <div class="notes-header">
                    <div class="notes-label">
                        <i class="fas fa-user-md"></i> Pharmacist Notes
                    </div>
                    <div class="notes-date">
                        {{ current_date.strftime('%Y-%m-%d %H:%M') }}
                    </div>
                </div>
                <p class="notes-text">
                    This interaction check was performed using the Smart Pharma Assistant database. 
                    Always verify with authoritative sources before making clinical decisions.
                </p>
            </div>
        </div>
    </div>
    
    <!-- Action Section -->
    <div class="actions-section">
        <h2 class="section-title">
            <i class="fas fa-cogs"></i> Recommended Actions
        </h2>
        
        <div class="actions-grid">
            <a href="javascript:void(0);" class="action-card" onclick="printResults()">
                <div class="action-icon" style="--action-color: #1565C0; --action-color-dark: #0D47A1;">
                    <i class="fas fa-print"></i>
                </div>
                <div class="action-title">Print Report</div>
                <div class="action-desc">Print this interaction analysis for patient records</div>
            </a>
            
            <a href="{{ url_for('check_interaction') }}" class="action-card">
                <div class="action-icon" style="--action-color: #00897B; --action-color-dark: #00695C;">
                    <i class="fas fa-redo"></i>
                </div>
                <div class="action-title">New Check</div>
                <div class="action-desc">Check interaction between different medications</div>
            </a>
            
            {% if severity == 'High' or severity == 'Medium' %}
            <a href="javascript:void(0);" class="action-card" onclick="alertPrescriber()">
                <div class="action-icon" style="--action-color: #D32F2F; --action-color-dark: #B71C1C;">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="action-title">Alert Prescriber</div>
                <div class="action-desc">Notify the prescribing physician about this interaction</div>
            </a>
            
            <a href="javascript:void(0);" class="action-card" onclick="addPatientNote()">
                <div class="action-icon" style="--action-color: #FF8F00; --action-color-dark: #EF6C00;">
                    <i class="fas fa-file-medical"></i>
                </div>
                <div class="action-title">Add Patient Note</div>
                <div class="action-desc">Document this interaction in patient records</div>
            </a>
            {% else %}
            <a href="{{ url_for('recommend_medicine') }}" class="action-card">
                <div class="action-icon" style="--action-color: #9C27B0; --action-color-dark: #7B1FA2;">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="action-title">AI Recommendation</div>
                <div class="action-desc">Get AI-powered medicine suggestions</div>
            </a>
            
            <a href="{{ url_for('view_medicines') }}" class="action-card">
                <div class="action-icon" style="--action-color: #388E3C; --action-color-dark: #2E7D32;">
                    <i class="fas fa-capsules"></i>
                </div>
                <div class="action-title">View Medicines</div>
                <div class="action-desc">Browse complete medicine inventory</div>
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- Patient Education Notes -->
    {% if severity == 'High' or severity == 'Medium' %}
    <div class="patient-notes">
        <h3 class="notes-title">
            <i class="fas fa-user-injured"></i> Patient Education Points
        </h3>
        <p class="notes-content">
            <strong>When discussing this interaction with the patient:</strong><br>
            1. Explain the specific risks in simple terms<br>
            2. Provide written instructions if possible<br>
            3. Discuss symptoms to watch for<br>
            4. Provide emergency contact information<br>
            5. Schedule follow-up if needed
        </p>
    </div>
    {% endif %}
    
    <!-- Back Button -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{{ url_for('check_interaction') }}" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Interaction Checker
        </a>
    </div>
</div>

<!-- JavaScript -->
<script>
// Global functions
function printResults() {
    window.print();
    showNotification('Print dialog opened', 'info');
}

function alertPrescriber() {
    const message = `URGENT: Drug Interaction Alert\n\n` +
                   `Drugs: {{ drug1 }} and {{ drug2 }}\n` +
                   `Severity: {{ severity if interaction else 'None' }}\n` +
                   `Interaction: {{ interaction.description if interaction else 'No known interaction' }}\n\n` +
                   `Recommendation: {{ interaction.recommendation if interaction else 'Monitor patient' }}\n\n` +
                   `Checked by: Smart Pharma Assistant`;
    
    if (confirm('Generate prescriber alert message?\n\nThis would typically open your email client.')) {
        const emailLink = `mailto:prescriber@example.com?subject=Drug%20Interaction%20Alert&body=${encodeURIComponent(message)}`;
        window.open(emailLink, '_blank');
        showNotification('Prescriber alert generated', 'success');
    }
}

function addPatientNote() {
    const note = `Drug Interaction Note - {{ current_date.strftime('%Y-%m-%d %H:%M') }}\n\n` +
                `Medications: {{ drug1 }} + {{ drug2 }}\n` +
                `Severity: {{ severity if interaction else 'None' }}\n` +
                `Action Taken: Interaction discussed with patient\n` +
                `Follow-up: Monitor for adverse effects`;
    
    if (confirm('Add this note to patient records?\n\nIn a real system, this would save to the patient file.')) {
        // Simulate saving to backend
        localStorage.setItem('patientNote_' + Date.now(), note);
        showNotification('Patient note added successfully', 'success');
    }
}

function showNotification(message, type) {
    // Remove existing notifications
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => notification.remove());
    
    // Create notification
    const notification = document.createElement('div');
    notification.className = `notification alert alert-${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
        ${message}
    `;
    
    // Style the notification
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        animation: slideInRight 0.3s ease-out;
        background: ${type === 'success' ? '#4CAF50' : type === 'info' ? '#2196F3' : '#FF9800'};
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    `;
    
    document.body.appendChild(notification);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.style.animation = 'slideOutRight 0.3s ease-out';
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}

// Add CSS for animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(100%); }
        to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes slideOutRight {
        from { opacity: 1; transform: translateX(0); }
        to { opacity: 0; transform: translateX(100%); }
    }
`;
document.head.appendChild(style);

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl+P to print
    if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        printResults();
    }
    
    // Escape to go back
    if (e.key === 'Escape') {
        window.location.href = "{{ url_for('check_interaction') }}";
    }
});

// Highlight severity on load
document.addEventListener('DOMContentLoaded', function() {
    const severity = '{{ severity if interaction else "none" }}'.toLowerCase();
    if (severity === 'high') {
        // Add urgent animation to header
        const header = document.querySelector('.page-header');
        header.style.animation = 'pulseBackground 2s infinite';
        
        const pulseStyle = document.createElement('style');
        pulseStyle.textContent = `
            @keyframes pulseBackground {
                0%, 100% { box-shadow: 0 15px 35px rgba(211, 47, 47, 0.2); }
                50% { box-shadow: 0 15px 35px rgba(211, 47, 47, 0.4); }
            }
        `;
        document.head.appendChild(pulseStyle);
    }
});
</script>
{% endblock %}

{% macro get_drug_type(drug_name) %}
    {% set drug_types = {
        'Warfarin': 'Anticoagulant (Blood Thinner)',
        'Aspirin': 'NSAID / Antiplatelet',
        'Ibuprofen': 'NSAID (Non-Steroidal Anti-Inflammatory)',
        'Paracetamol': 'Analgesic (Pain Reliever)',
        'Metformin': 'Anti-diabetic (Biguanide)',
        'Amoxicillin': 'Antibiotic (Penicillin)',
        'Cetirizine': 'Antihistamine',
        'Omeprazole': 'Proton Pump Inhibitor',
        'Atorvastatin': 'Statin (Cholesterol)',
        'Levothyroxine': 'Thyroid Hormone',
        'Losartan': 'ARB (Blood Pressure)',
        'Sertraline': 'SSRI (Antidepressant)',
        'Clopidogrel': 'Antiplatelet',
        'Insulin': 'Anti-diabetic (Hormone)',
        'Digoxin': 'Cardiac Glycoside',
        'Furosemide': 'Diuretic',
        'Alcohol': 'Substance',
        'Caffeine': 'Stimulant'
    } %}
    {{ drug_types.get(drug_name, 'Medication') }}
{% endmacro %}

{% macro get_drug_class(drug_name) %}
    {% set drug_classes = {
        'Warfarin': 'Vitamin K Antagonist',
        'Aspirin': 'Salicylate / NSAID',
        'Ibuprofen': 'NSAID (Propionic Acid Derivative)',
        'Paracetamol': 'Analgesic & Antipyretic',
        'Metformin': 'Biguanide',
        'Amoxicillin': 'Aminopenicillin',
        'Cetirizine': 'Second-generation Antihistamine',
        'Omeprazole': 'Benzimidazole',
        'Atorvastatin': 'HMG-CoA Reductase Inhibitor',
        'Levothyroxine': 'Thyroid Hormone Replacement',
        'Losartan': 'Angiotensin II Receptor Blocker',
        'Sertraline': 'Selective Serotonin Reuptake Inhibitor',
        'Clopidogrel': 'Thienopyridine',
        'Insulin': 'Peptide Hormone',
        'Digoxin': 'Cardiac Glycoside',
        'Furosemide': 'Loop Diuretic',
        'Alcohol': 'Central Nervous System Depressant',
        'Caffeine': 'Xanthine Alkaloid'
    } %}
    {{ drug_classes.get(drug_name, 'Not Specified') }}
{% endmacro %}

{% macro get_drug_uses(drug_name) %}
    {% set drug_uses = {
        'Warfarin': 'Prevention and treatment of blood clots, stroke prevention in atrial fibrillation',
        'Aspirin': 'Pain relief, fever reduction, prevention of heart attacks and strokes',
        'Ibuprofen': 'Pain relief, inflammation reduction, fever reduction',
        'Paracetamol': 'Pain relief, fever reduction',
        'Metformin': 'Type 2 diabetes management, insulin resistance',
        'Amoxicillin': 'Bacterial infections (ear, nose, throat, skin, urinary tract)',
        'Cetirizine': 'Allergy symptoms, hay fever, hives, allergic rhinitis',
        'Omeprazole': 'Acid reflux, GERD, stomach ulcers, Zollinger-Ellison syndrome',
        'Atorvastatin': 'High cholesterol, prevention of cardiovascular events',
        'Levothyroxine': 'Hypothyroidism, thyroid hormone replacement',
        'Losartan': 'High blood pressure, diabetic kidney disease',
        'Sertraline': 'Depression, anxiety disorders, OCD, PTSD',
        'Clopidogrel': 'Prevention of blood clots after heart attack/stroke',
        'Insulin': 'Diabetes management (Type 1 and Type 2)',
        'Digoxin': 'Heart failure, atrial fibrillation',
        'Furosemide': 'Edema (fluid retention), high blood pressure, heart failure',
        'Alcohol': 'Recreational use, social drinking',
        'Caffeine': 'Stimulant, alertness, fatigue reduction'
    } %}
    {{ drug_uses.get(drug_name, 'Consult drug information for specific uses') }}
{% endmacro %}

{% macro get_drug_side_effects(drug_name) %}
    {% set drug_side_effects = {
        'Warfarin': 'Bleeding, bruising, rash, hair loss\nMonitor: INR regularly',
        'Aspirin': 'Stomach upset, ulcers, bleeding, ringing in ears\nMonitor: GI symptoms',
        'Ibuprofen': 'Stomach pain, nausea, dizziness, kidney issues\nMonitor: Renal function',
        'Paracetamol': 'Liver damage (overdose), nausea, rash\nMonitor: Liver enzymes',
        'Metformin': 'Diarrhea, nausea, stomach pain, lactic acidosis (rare)\nMonitor: Renal function',
        'Amoxicillin': 'Diarrhea, nausea, rash, allergic reactions\nMonitor: Allergic symptoms',
        'Cetirizine': 'Drowsiness, dry mouth, headache, fatigue\nMonitor: Sedation',
        'Omeprazole': 'Headache, diarrhea, nausea, vitamin B12 deficiency\nMonitor: Long-term use',
        'Atorvastatin': 'Muscle pain, liver damage, diabetes risk\nMonitor: CK, liver enzymes',
        'Levothyroxine': 'Palpitations, weight loss, insomnia, anxiety\nMonitor: TSH levels',
        'Losartan': 'Dizziness, fatigue, cough, hyperkalemia\nMonitor: Blood pressure, potassium',
        'Sertraline': 'Nausea, insomnia, sexual dysfunction, weight changes\nMonitor: Mood changes',
        'Clopidogrel': 'Bleeding, rash, diarrhea, stomach pain\nMonitor: Bleeding signs',
        'Insulin': 'Hypoglycemia, weight gain, injection site reactions\nMonitor: Blood glucose',
        'Digoxin': 'Nausea, vomiting, confusion, visual disturbances\nMonitor: Digoxin levels',
        'Furosemide': 'Dehydration, low potassium, dizziness, hearing loss\nMonitor: Electrolytes',
        'Alcohol': 'Impaired coordination, liver damage, addiction\nMonitor: Consumption',
        'Caffeine': 'Insomnia, anxiety, palpitations, dependency\nMonitor: Intake'
    } %}
    {{ drug_side_effects.get(drug_name, 'Consult drug information for side effects') }}
{% endmacro %}